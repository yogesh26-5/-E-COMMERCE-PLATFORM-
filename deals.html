<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deals - ShopPWA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <style>
        .product-detail-section, .cart-section { display: none; }
        .deal-card .badge { font-size: 0.9rem; }
        .original-price { text-decoration: line-through; color: #6c757d; }
        .deal-price { color: #dc3545; font-weight: bold; }
        .back-to-deals, .back-to-main { cursor: pointer; color: #0d6efd; }
        .back-to-deals:hover, .back-to-main:hover { text-decoration: underline; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1100; }
        .toast { border-left: 4px solid #0d6efd; }
        .cart-item-img { width: 80px; height: 80px; object-fit: cover; }
        .quantity-btn { width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div class="toast-container">
        <div id="cartToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">ShopPWA</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <span id="toastMessage">Item added to cart!</span>
            </div>
        </div>
    </div>

    <!-- Header/Navbar -->
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold" href="index.html">
                    <span class="text-primary">Shop</span><span class="text-dark">PWA</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="categories.html">Categories</a></li>
                        <li class="nav-item"><a class="nav-link active" href="deals.html">Deals</a></li>
                        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <button id="cartBtn" class="btn btn-outline-primary position-relative me-2">
                            <i class="bi bi-cart"></i>
                            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </button>
                        <button id="installBtn" class="btn btn-primary d-none d-md-inline-block">Install App</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="py-4">
        <div class="container">
            <!-- Deals Section -->
            <section class="deals-section py-5">
                <div class="text-center mb-5">
                    <h2 class="display-5 fw-bold">Today's Best Deals</h2>
                    <p class="lead text-muted">Limited time offers - shop now!</p>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 border-0 shadow-sm position-relative deal-card" data-product-id="101">
                            <span class="position-absolute top-0 end-0 m-2 badge bg-danger">50% OFF</span>
                            <img src="premium earbudss.jpg" class="card-img-top" alt="Wireless Earbuds Deal" loading="lazy">
                            <div class="card-body">
                                <h3 class="h5 card-title">Premium Wireless Earbuds</h3>
                                <div class="d-flex align-items-center mb-3">
                                    <span class="original-price me-2">₹1499.99</span>
                                    <span class="deal-price">₹749.99</span>
                                </div>
                                <button class="btn btn-primary w-100 get-deal-btn">Get Deal</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 border-0 shadow-sm position-relative deal-card" data-product-id="102">
                            <span class="position-absolute top-0 end-0 m-2 badge bg-danger">30% OFF</span>
                            <img src="smart watch.jpeg" class="card-img-top" alt="Smart Watch Deal" loading="lazy">
                            <div class="card-body">
                                <h3 class="h5 card-title">Smart Watch Pro</h3>
                                <div class="d-flex align-items-center mb-3">
                                    <span class="original-price me-2">₹999.99</span>
                                    <span class="deal-price">₹699.99</span>
                                </div>
                                <button class="btn btn-primary w-100 get-deal-btn">Get Deal</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 border-0 shadow-sm position-relative deal-card" data-product-id="103">
                            <span class="position-absolute top-0 end-0 m-2 badge bg-danger">BUY 1 GET 1</span>
                            <img src="backpack.jpeg" class="card-img-top" alt="Backpack Deal" loading="lazy">
                            <div class="card-body">
                                <h3 class="h5 card-title">Travel Backpack</h3>
                                <div class="d-flex align-items-center mb-3">
                                    <span class="original-price me-2">₹2999.99</span>
                                    <span class="deal-price">2 for ₹1999.99</span>
                                </div>
                                <button class="btn btn-primary w-100 get-deal-btn">Get Deal</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Product Detail Section -->
            <section class="product-detail-section py-5">
                <div class="d-flex align-items-center mb-4">
                    <span class="back-to-deals me-3"><i class="bi bi-arrow-left"></i> Back to deals</span>
                    <h2 id="product-title" class="mb-0"></h2>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm mb-4">
                            <img id="product-detail-image" src="" class="card-img-top" alt="Product Image" loading="lazy">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h3 id="product-detail-name" class="h4 card-title"></h3>
                                <div class="d-flex align-items-center mb-3">
                                    <span id="product-original-price" class="original-price me-2"></span>
                                    <span id="product-deal-price" class="deal-price"></span>
                                </div>
                                <p id="product-description" class="card-text mb-4"></p>
                                
                                <div class="d-flex gap-2 mb-4">
                                    <button id="add-to-cart-btn" class="btn btn-primary flex-grow-1">
                                        <i class="bi bi-cart-plus"></i> Add to Cart
                                    </button>
                                    <button id="buy-now-btn" class="btn btn-danger flex-grow-1">
                                        <i class="bi bi-lightning"></i> Buy Now
                                    </button>
                                </div>
                                
                                <div class="accordion" id="productAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#detailsCollapse">Product Details</button>
                                        </h2>
                                        <div id="detailsCollapse" class="accordion-collapse collapse show" data-bs-parent="#productAccordion">
                                            <div class="accordion-body">
                                                <ul id="product-details-list" class="list-unstyled"></ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#shippingCollapse">Shipping & Returns</button>
                                        </h2>
                                        <div id="shippingCollapse" class="accordion-collapse collapse" data-bs-parent="#productAccordion">
                                            <div class="accordion-body">
                                                <p>Free shipping on all orders over ₹50. Returns accepted within 30 days.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Cart Section -->
            <section class="cart-section py-5">
                <div class="d-flex align-items-center mb-4">
                    <span class="back-to-main me-3"><i class="bi bi-arrow-left"></i> Back to deals</span>
                    <h2 class="mb-0">Your Shopping Cart</h2>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <div id="cart-items-container">
                                    <div class="text-center py-5" id="empty-cart-message">
                                        <i class="bi bi-cart-x text-muted" style="font-size: 3rem;"></i>
                                        <h4 class="mt-3">Your cart is empty</h4>
                                        <p class="text-muted">Browse our deals and add some items to your cart</p>
                                        <button class="btn btn-primary back-to-main">Shop Deals</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h3 class="h5 card-title">Order Summary</h3>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Subtotal</span>
                                    <span id="cart-subtotal">₹0.00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Shipping</span>
                                    <span id="cart-shipping">₹0.00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-3">
                                    <span class="text-muted">Tax</span>
                                    <span id="cart-tax">₹0.00</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-3">
                                    <span class="fw-bold">Total</span>
                                    <span class="fw-bold" id="cart-total">₹0.00</span>
                                </div>
                                <button class="btn btn-primary w-100" id="checkout-btn">Proceed to Checkout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ShopPWA</h3>
                    <p>An offline-first e-commerce progressive web application.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="categories.html">Categories</a></li>
                        <li><a href="deals.html">Deals</a></li>
                        <li><a href="about.html">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 ShopPWA. All rights reserved.</p>
                <div class="connection-status">
                    <span id="connectionStatus" class="badge bg-success">Online</span>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize toast
        const cartToast = new bootstrap.Toast(document.getElementById('cartToast'), { autohide: true, delay: 3000 });

        // Product data
        const dealsProducts = {
            101: {
                id: 101,
                name: "Premium Wireless Earbuds",
                originalPrice: 1499.99,
                dealPrice: 749.99,
                dealType: "50% OFF",
                image: "premium earbudss.jpg",
                description: "Experience crystal-clear sound with our premium wireless earbuds. Featuring noise cancellation and 24-hour battery life.",
                details: [
                    "Bluetooth 5.0 technology",
                    "IPX7 waterproof rating",
                    "6mm dynamic drivers",
                    "Touch controls",
                    "Includes charging case"
                ],
                category: "electronics"
            },
            102: {
                id: 102,
                name: "Smart Watch Pro",
                originalPrice: 999.99,
                dealPrice: 699.99,
                dealType: "30% OFF",
                image: "smart watch.jpeg",
                description: "Track your fitness and stay connected with this feature-packed smartwatch. Heart rate monitoring, GPS, and smartphone notifications.",
                details: [
                    "1.4\" AMOLED display",
                    "7-day battery life",
                    "50m water resistance",
                    "100+ sport modes",
                    "Blood oxygen monitoring"
                ],
                category: "electronics"
            },
            103: {
                id: 103,
                name: "Travel Backpack",
                originalPrice: 2999.99,
                dealPrice: 1999.99,
                dealType: "BUY 1 GET 1",
                image: "backpack.jpeg",
                description: "Durable and spacious travel backpack with multiple compartments. Perfect for work, travel, or everyday use.",
                details: [
                    "35L capacity",
                    "Water-resistant material",
                    "USB charging port",
                    "Padded laptop compartment",
                    "Ergonomic shoulder straps"
                ],
                category: "clothing"
            }
        };

        // Cart functionality
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        function updateCartCount() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }
        
        function showCartNotification(message) {
            document.getElementById('toastMessage').textContent = message;
            cartToast.show();
        }
        
        function addToCart(productId) {
            const product = dealsProducts[productId];
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ 
                    ...product, 
                    quantity: 1,
                    price: product.dealPrice
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showCartNotification(`${product.name} added to cart!`);
        }
        
        function buyNow(productId) {
            addToCart(productId);
            showCartView();
        }

        function showCartView() {
            document.querySelector('.deals-section').style.display = 'none';
            document.querySelector('.product-detail-section').style.display = 'none';
            document.querySelector('.cart-section').style.display = 'block';
            renderCartItems();
            updateCartSummary();
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items-container');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5" id="empty-cart-message">
                        <i class="bi bi-cart-x text-muted" style="font-size: 3rem;"></i>
                        <h4 class="mt-3">Your cart is empty</h4>
                        <p class="text-muted">Browse our deals and add some items to your cart</p>
                        <button class="btn btn-primary back-to-main">Shop Deals</button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            cart.forEach(item => {
                html += `
                    <div class="cart-item mb-3 pb-3 border-bottom" data-product-id="${item.id}">
                        <div class="row">
                            <div class="col-3">
                                <img src="${item.image}" alt="${item.name}" class="cart-item-img rounded">
                            </div>
                            <div class="col-6">
                                <h5 class="mb-1">${item.name}</h5>
                                <p class="mb-2 text-muted">₹${item.price.toFixed(2)}</p>
                                <div class="d-flex align-items-center">
                                    <button class="btn btn-sm btn-outline-secondary quantity-btn decrease-quantity">-</button>
                                    <span class="mx-2 quantity">${item.quantity}</span>
                                    <button class="btn btn-sm btn-outline-secondary quantity-btn increase-quantity">+</button>
                                </div>
                            </div>
                            <div class="col-3 text-end">
                                <p class="mb-2 fw-bold">₹${(item.price * item.quantity).toFixed(2)}</p>
                                <button class="btn btn-sm btn-outline-danger remove-item">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Add event listeners to quantity buttons
            document.querySelectorAll('.increase-quantity').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.closest('.cart-item').dataset.productId);
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        item.quantity += 1;
                        localStorage.setItem('cart', JSON.stringify(cart));
                        renderCartItems();
                        updateCartSummary();
                        updateCartCount();
                    }
                });
            });
            
            document.querySelectorAll('.decrease-quantity').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.closest('.cart-item').dataset.productId);
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        if (item.quantity > 1) {
                            item.quantity -= 1;
                        } else {
                            cart = cart.filter(i => i.id !== productId);
                        }
                        localStorage.setItem('cart', JSON.stringify(cart));
                        renderCartItems();
                        updateCartSummary();
                        updateCartCount();
                    }
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.closest('.cart-item').dataset.productId);
                    cart = cart.filter(item => item.id !== productId);
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCartItems();
                    updateCartSummary();
                    updateCartCount();
                    showCartNotification('Item removed from cart');
                });
            });
        }

        function updateCartSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > 250 || cart.length === 0 ? 0 : 150.99;
            const tax = subtotal * 0.1;
            
            document.getElementById('cart-subtotal').textContent = `₹${subtotal.toFixed(2)}`;
            document.getElementById('cart-shipping').textContent = shipping === 0 ? 'FREE' : `₹${shipping.toFixed(2)}`;
            document.getElementById('cart-tax').textContent = `₹${tax.toFixed(2)}`;
            document.getElementById('cart-total').textContent = `₹${(subtotal + shipping + tax).toFixed(2)}`;
        }

        function showProductDetail(productId) {
            const product = dealsProducts[productId];
            if (!product) return;
            
            document.querySelector('.deals-section').style.display = 'none';
            document.querySelector('.product-detail-section').style.display = 'block';
            document.querySelector('.cart-section').style.display = 'none';
            document.querySelector('.product-detail-section').dataset.productId = productId;
            document.getElementById('product-title').textContent = product.name;
            
            document.getElementById('product-detail-image').src = product.image;
            document.getElementById('product-detail-image').alt = product.name;
            document.getElementById('product-detail-name').textContent = product.name;
            document.getElementById('product-original-price').textContent = `₹${product.originalPrice.toFixed(2)}`;
            
            if (product.dealType === "BUY 1 GET 1") {
                document.getElementById('product-deal-price').textContent = product.dealType;
            } else {
                document.getElementById('product-deal-price').textContent = `₹${product.dealPrice.toFixed(2)}`;
            }
            
            document.getElementById('product-description').textContent = product.description;
            
            const detailsList = document.getElementById('product-details-list');
            detailsList.innerHTML = '';
            product.details.forEach(detail => {
                const li = document.createElement('li');
                li.className = 'mb-2';
                li.innerHTML = `<i class="bi bi-check-circle-fill text-success me-2"></i>${detail}`;
                detailsList.appendChild(li);
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            
            document.querySelectorAll('.get-deal-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const productId = this.closest('.deal-card').dataset.productId;
                    showProductDetail(productId);
                });
            });
            
            document.querySelector('.back-to-deals').addEventListener('click', function() {
                document.querySelector('.deals-section').style.display = 'block';
                document.querySelector('.product-detail-section').style.display = 'none';
                document.querySelector('.cart-section').style.display = 'none';
            });
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('back-to-main')) {
                    document.querySelector('.deals-section').style.display = 'block';
                    document.querySelector('.product-detail-section').style.display = 'none';
                    document.querySelector('.cart-section').style.display = 'none';
                }
            });
            
            document.getElementById('cartBtn').addEventListener('click', showCartView);
            document.getElementById('add-to-cart-btn').addEventListener('click', function() {
                const productId = this.closest('.product-detail-section').dataset.productId;
                addToCart(productId);
            });
            
            document.getElementById('buy-now-btn').addEventListener('click', function() {
                const productId = this.closest('.product-detail-section').dataset.productId;
                buyNow(productId);
            });
            
            document.getElementById('checkout-btn').addEventListener('click', function() {
                if (cart.length === 0) {
                    showCartNotification('Your cart is empty');
                } else {
                    showCartNotification('Proceeding to checkout');
                    window.location.href="checkout.html";
                }
            });
        });
    </script>
    <script src="app.js"></script>
</body>
</html>